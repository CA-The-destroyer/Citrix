# 1) Paste your token into $tok
$tok = "<ACCESS_TOKEN>"
$base = "https://api-us.cloud.com"   # change region if needed
$cust = "<CustomerId>"

# 2) One-line GET
Invoke-RestMethod -Uri "$base/monitorodata/$cust/v4/data/Machines`?$top=1000" `
  -Headers @{Authorization="CwsAuth bearer $tok"; "Citrix-CustomerId"=$cust; Accept="application/json"} `
  -Method Get




Invoke-RestMethod -Uri "https://api-us.cloud.com/monitorodata/<CustomerId>/v4/data/Machines?`$top=1000" -Headers @{Authorization="CwsAuth bearer <ACCESS_TOKEN>";"Citrix-CustomerId"="<CustomerId>";Accept="application/json"} -Method Get | ConvertTo-Json -Depth 6 | Out-File .\machines.json -Encoding utf8



Invoke-RestMethod -Uri "$base/monitorodata/$cust/v4/data/Machines?`$top=1000" `
  -Headers @{ Authorization = "bearer $($tok.access_token)"; "Citrix-CustomerId" = $cust; Accept = "application/json" } `
  -Method Get


Invoke-RestMethod -Uri "$base/monitorodata/$cust/v4/data/Machines?`$top=1000" `
  -Headers @{ Authorization = "Bearer $($tok.access_token)"; "Citrix-CustomerId" = $cust; Accept = "application/json" } `
  -Method Get | ConvertTo-Json -Depth 6 | Out-File .\machines.json -Encoding utf8




# 1) Get token (form-encoded)
$base="https://api-us.cloud.com"; $cust="<CustomerId>"; $cid="<ClientId>"; $sec="<ClientSecret>"
$tok = Invoke-RestMethod -Method Post -Uri "$base/cctrustoauth2/$cust/tokens/clients" `
  -ContentType "application/x-www-form-urlencoded" `
  -Body "grant_type=client_credentials&client_id=$cid&client_secret=$sec"

# 2) Use token_type=bearer â†’ Authorization: Bearer <token>
Invoke-RestMethod -Uri "$base/monitorodata/$cust/v4/data/Machines?`$top=1000" `
  -Headers @{ Authorization = "Bearer $($tok.access_token)"; "Citrix-CustomerId" = $cust; Accept = "application/json" } `
  -Method Get | ConvertTo-Json -Depth 6 | Out-File .\machines.json -Encoding utf8

